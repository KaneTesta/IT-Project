<!DOCTYPE html>
<html>

<%- include('../includes/head'); %>

<body>

    <div class="main-content">
        <%- include('../includes/elements/navigation'); %>

        <div class="page-content">
            <h1>Dashboard</h1>

            <h2>My Artefacts</h2>
            <div id="DashboardGridMyArtefacts" class="dashboard-grid">
                <% if (artefacts.owner) { %>
                <% for (let i = 0; i < artefacts.owner.length; ++i) { %>
                <%- include('artefact', { artefact: artefacts.owner[i] }); %>
                <% }; %>
                <% }; %>

                <button id="PageButtonAddArtefact" class="dashboard-artefact page-action button-icon-noborder">
                    <i class="material-icons-outlined">add</i>
                    <p>Add New Artefact</p>
                </button>
            </div>

            <h2>Shared Artefacts</h2>
            <% if (artefacts.viewer && artefacts.viewer.length > 0) { %>

            <% let viewerUsers = artefacts.viewer.reduce((rv, x) => {
                    if (x.owner) {
                        (rv[x.owner.display_name] = rv[x.owner.display_name] || []).push(x);
                    }

                    return rv;
                }, {}); %>
            <% let usersForUserIds = artefacts.viewer.reduce((rv, x) => {
                    rv[x.owner.id] = x.owner;
                    return rv;
                }, {}); %>
            <% let userIds = Object.keys(artefactsForUserIds).sort(); %>

            <% for (let i = 0; i < userIds.length; ++i) { %>
            <% let userArtefacts = artefactsForUserIds[userIds[i]]; %>
            <% let userOwner = usersForUserIds[userIds[i]]; %>

            <h3><%= userOwner.display_name %></h3>
            <div id="DashboardGridSharedArtefacts" class="dashboard-grid">
                <% for (let j = 0; j < userArtefacts.length; ++j) { %>
                <%- include('artefact', { artefact: userArtefacts[j] }); %>
                <% }; %>
            </div>

            <% }; %>
            <% } else { %>
            <p class="text-description">Artefacts that other users share with you will show up here.</p>
            <% }; %>
        </div>

        <%- include('../includes/dialogs/dialogAddArtefact'); %>
        <%- include('../includes/dialogs/dialogViewArtefact'); %>
        <%- include('../includes/dialogs/dialogAddViewers'); %>
        <%- include('../includes/dialogs/dialogEditArtefact'); %>
    </div>

    <script defer src="/js/dashboard.js"></script>
    <%- include('../includes/scripts'); %>

</body>

</html>
